<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Barreto App</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:#f2f2f7;
}

.container{
  max-width:430px;
  margin:auto;
  padding:20px;
}

.card{
  background:white;
  padding:20px;
  border-radius:20px;
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
  margin-bottom:20px;
}

input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:12px;
  border:1px solid #ddd;
  font-size:16px;
}

button{
  background:black;
  color:white;
  border:none;
}

h2{
  text-align:center;
}
</style>
</head>
<body>

<div class="container">

<!-- LOGIN -->
<div id="loginScreen" class="card">
<h2>Login</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
<button onclick="register()">Criar Conta</button>
</div>

<!-- APP -->
<div id="appScreen" style="display:none;">

<div class="card">
<h2>Cadastro Cliente</h2>
<input type="text" id="nome" placeholder="Nome">
<input type="text" id="telefone" placeholder="Telefone">
<input type="text" id="cep" placeholder="CEP">
<input type="text" id="rua" placeholder="Rua">
<input type="text" id="bairro" placeholder="Bairro">
<input type="text" id="cidade" placeholder="Cidade">
<button onclick="salvarCliente()">Salvar</button>
</div>

<div class="card">
<h2>Buscar Cliente</h2>
<input type="text" id="busca" placeholder="Digite o nome">
<button onclick="buscarCliente()">Buscar</button>
<div id="resultado"></div>
</div>

<button onclick="logout()">Sair</button>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBP8lpsBu0QX6ROmK7Ligb9s9XvunBppzA",
  authDomain: "barreto-f590b.firebaseapp.com",
  projectId: "barreto-f590b",
  storageBucket: "barreto-f590b.firebasestorage.app",
  messagingSenderId: "780260431308",
  appId: "1:780260431308:web:71f990a107e4cc62db7969"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.login = async function(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  await signInWithEmailAndPassword(auth,email,password);
}

window.register = async function(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  await createUserWithEmailAndPassword(auth,email,password);
}

window.logout = function(){
  signOut(auth);
}

onAuthStateChanged(auth,(user)=>{
  if(user){
    loginScreen.style.display="none";
    appScreen.style.display="block";
  }else{
    loginScreen.style.display="block";
    appScreen.style.display="none";
  }
});

window.salvarCliente = async function(){
  await addDoc(collection(db,"clientes"),{
    nome:nome.value,
    telefone:telefone.value,
    cep:cep.value,
    rua:rua.value,
    bairro:bairro.value,
    cidade:cidade.value
  });
  alert("Cliente salvo!");
}

window.buscarCliente = async function(){
  const q = query(collection(db,"clientes"),where("nome","==",busca.value));
  const querySnapshot = await getDocs(q);
  resultado.innerHTML="";
  querySnapshot.forEach((doc)=>{
    resultado.innerHTML += `<p>${doc.data().nome} - ${doc.data().telefone}</p>`;
  });
}

</script>
</body>
</html>
